import{_ as v,s as p,a as b,u as n,c as C,b as x,d as o,w as s,r as h,o as f,e as F,f as w,g,t as _,p as k,h as y}from"./index-D49ookEs.js";const D={data(){return{codeText:"获取验证码",codeDisabled:!1,countDown:0,isRes:!1,ruleForm:{name:"",phone:"",idCard:"",code:""},rules:{name:[{required:!0,message:"请输入有效姓名",trigger:"blur"},{min:2,message:"请输入有效姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],idCard:[{required:!0,message:"请输入身份证号码",trigger:"blur"},{pattern:/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(10|11|12))((0[1-9])|([1-2][0-9])|30|31)\d{3}[0-9Xx]$/,message:"请输入有效的身份证号码",trigger:"blur"}]}}},methods:{submitForm(l){this.$refs[l].validate(t=>{if(t)if(console.log("submit!"),this.isRes){const a={certificate:this.ruleForm.idCard,username:this.ruleForm.name,telephone:this.ruleForm.phone,authcode:this.ruleForm.code};p.post("/signup",a).then(u=>{this.isRes=!1;const e={telephone:this.ruleForm.phone,authcode:this.ruleForm.code};p.post("/login",e).then(i=>{b.set("token",i.data.token),n().writeUsername(i.data.username),n().writeTelephone(i.data.telephone),n().writeAdmin(i.data.admin),n().admin?this.$router.push({path:"/admin"}):this.$router.push({path:"/user"})})})}else{const a={telephone:this.ruleForm.phone,authcode:this.ruleForm.code};p.post("/login",a).then(u=>{b.set("token",u.data.token),n().writeUsername(u.data.username),n().writeTelephone(u.data.telephone),n().writeAdmin(u.data.admin),n().admin?this.$router.push({path:"/admin"}):this.$router.push({path:"/user"})})}else return console.log("error submit!!"),!1})},getAuthCode(){var l=/^1[3-9]\d{9}$/;if(l.test(this.ruleForm.phone)){p.get(`/sms?telephone=${this.ruleForm.phone}`).then(a=>{}),this.codeDisabled=!0,this.countDown=60,this.codeText=`请${this.countDown}秒后再试`;let t=setInterval(()=>{this.countDown--,this.codeText=`请${this.countDown}秒后再试`,this.countDown<=0&&(this.codeText="获取验证码",clearInterval(t),this.codeDisabled=!1)},1e3)}else this.$message({message:"请检查手机号是否正确",type:"error",duration:5e3,plain:!0})}}},R=l=>(k("data-v-3cb8ae38"),l=l(),y(),l),T={class:"w-100 d-flex justify-content-center align-items-center",style:{height:"100vh"}},q={class:"log-res-box",style:{"box-shadow":"var(--el-box-shadow-dark)"}},I=R(()=>x("h4",{class:"text-center mt-3"},"实习生小助手",-1));function U(l,t,a,u,e,i){const m=h("el-input"),d=h("el-form-item"),c=h("el-button"),V=h("el-form");return f(),C("div",T,[x("div",q,[I,o(V,{model:e.ruleForm,rules:e.rules,ref:"ruleForm","label-position":"top",style:{width:"100%"}},{default:s(()=>[e.isRes?(f(),F(d,{key:0,label:"姓名",prop:"name"},{default:s(()=>[o(m,{modelValue:e.ruleForm.name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.ruleForm.name=r)},null,8,["modelValue"])]),_:1})):w("",!0),e.isRes?(f(),F(d,{key:1,label:"身份证",prop:"idCard"},{default:s(()=>[o(m,{modelValue:e.ruleForm.idCard,"onUpdate:modelValue":t[1]||(t[1]=r=>e.ruleForm.idCard=r)},null,8,["modelValue"])]),_:1})):w("",!0),o(d,{label:"手机号",prop:"phone"},{default:s(()=>[o(m,{modelValue:e.ruleForm.phone,"onUpdate:modelValue":t[2]||(t[2]=r=>e.ruleForm.phone=r)},null,8,["modelValue"])]),_:1}),o(d,{label:"验证码",prop:"code"},{default:s(()=>[o(m,{modelValue:e.ruleForm.code,"onUpdate:modelValue":t[3]||(t[3]=r=>e.ruleForm.code=r)},{append:s(()=>[o(c,{onClick:i.getAuthCode,disabled:e.codeDisabled},{default:s(()=>[g(_(e.codeText),1)]),_:1},8,["onClick","disabled"])]),_:1},8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(c,{type:"primary",onClick:t[4]||(t[4]=r=>i.submitForm("ruleForm")),class:"w-100"},{default:s(()=>[g("立即"+_(e.isRes?"注册":"登录"),1)]),_:1}),o(c,{class:"w-100 mt-1 ms-0",onClick:t[5]||(t[5]=r=>e.isRes=!e.isRes)},{default:s(()=>[g("前往"+_(e.isRes?"登录":"注册"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])])])}const A=v(D,[["render",U],["__scopeId","data-v-3cb8ae38"]]);export{A as default};
